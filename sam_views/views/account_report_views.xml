<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        Template de totales de impuestos compatible con Odoo 18

        Este template puede usarse como reemplazo del template account.document_tax_totals_copy_1
        creado con Studio, el cual usa 'formatted_amount' que ya no existe en Odoo 18.

        En Odoo 18, los subtotales usan 'base_amount_currency' en lugar de 'formatted_amount'
        y se renderizan con el widget 'monetary' usando display_currency.
    -->

    <!-- Template de totales de impuestos - Compatible con Odoo 18 -->
    <template id="document_tax_totals_sam" name="Tax Totals Samper (Odoo 18)">
        <t t-set="same_tax_base" t-value="tax_totals.get('same_tax_base', False)"/>

        <table class="o_tax_totals_table table table-sm" style="page-break-inside: avoid;">
            <!-- Iterar sobre los subtotales -->
            <t t-foreach="tax_totals.get('subtotals', [])" t-as="subtotal">
                <!-- Fila del subtotal -->
                <tr class="o_subtotal">
                    <td>
                        <span t-out="subtotal.get('name', 'Subtotal')"/>
                    </td>
                    <td class="text-end">
                        <span t-att-class="'oe_subtotal_footer_separator'"
                              t-out="subtotal.get('base_amount_currency', subtotal.get('amount', 0.0))"
                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                    </td>
                </tr>

                <!-- Iterar sobre los grupos de impuestos en este subtotal -->
                <t t-foreach="subtotal.get('tax_groups', [])" t-as="tax_group">
                    <tr>
                        <td>
                            <span t-out="tax_group.get('group_name', 'Tax')"/>
                        </td>
                        <td class="text-end">
                            <span t-out="tax_group.get('tax_amount_currency', 0.0)"
                                  t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                        </td>
                    </tr>
                </t>
            </t>

            <!-- Fila de redondeo de efectivo si existe -->
            <t t-if="'cash_rounding' in tax_totals and tax_totals['cash_rounding']">
                <tr>
                    <td>
                        <span t-out="tax_totals['cash_rounding'].get('name', 'Rounding')"/>
                    </td>
                    <td class="text-end">
                        <span t-out="tax_totals['cash_rounding'].get('amount_currency', 0.0)"
                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                    </td>
                </tr>
            </t>

            <!-- Fila del total -->
            <tr class="o_total">
                <td>
                    <strong>Total</strong>
                </td>
                <td class="text-end">
                    <strong>
                        <span t-out="tax_totals.get('amount_total_currency', tax_totals.get('amount_total', 0.0))"
                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                    </strong>
                </td>
            </tr>
        </table>
    </template>

</odoo>
