<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template personalizado para facturas Samper -->
    <template id="report_invoice_document_inherit_samper" inherit_id="account.report_invoice_document" priority="99">

        <!-- Agregar estilos CSS personalizados -->
        <xpath expr="//div[@class='clearfix invoice_main']" position="before">
            <style>
                .samper-customer-box {
                    background-color: #f9f9f9;
                    padding: 10px;
                    border: 1px solid #ddd;
                    margin-bottom: 15px;
                }
                .samper-info-text {
                    font-size: 10px;
                    line-height: 1.5;
                }
                .table-samper th {
                    background-color: #e0e0e0;
                    border: 1px solid #666;
                    font-size: 11px;
                }
                .table-samper td {
                    border: 1px solid #666;
                    font-size: 11px;
                }
            </style>
        </xpath>

        <!-- Agregar información adicional del cliente después de la dirección -->
        <xpath expr="//div[@class='row']" position="after">
            <div class="samper-customer-box">
                <div class="row samper-info-text">
                    <div class="col-6">
                        <strong>Cliente:</strong> <span t-field="o.partner_id.name"/><br/>
                        <span t-field="o.partner_id.street"/><br/>
                        <span t-if="o.partner_id.street2"><span t-field="o.partner_id.street2"/><br/></span>
                        <span t-field="o.partner_id.zip"/> <span t-field="o.partner_id.city"/><br/>
                        <strong>RFC:</strong> <span t-field="o.partner_id.vat"/>
                    </div>
                    <div class="col-6">
                        <span t-if="o.partner_id.x_lp">
                            <strong>LP:</strong> <span t-field="o.partner_id.x_lp"/><br/>
                        </span>
                        <span t-if="o.partner_id.x_ruta">
                            <strong>Ruta:</strong> <span t-field="o.partner_id.x_ruta"/><br/>
                        </span>
                        <strong>Fecha:</strong> <span t-field="o.create_date" t-options='{"widget": "datetime", "format": "dd/MM/yyyy HH:mm:ss"}'/>
                    </div>
                </div>
            </div>
        </xpath>

        <!-- Ocultar la dirección original -->
        <xpath expr="//div[@class='row']" position="attributes">
            <attribute name="style">display: none;</attribute>
        </xpath>

        <!-- Aplicar estilos a la tabla -->
        <xpath expr="//table[@name='invoice_line_table']" position="attributes">
            <attribute name="class">table-samper table table-sm</attribute>
        </xpath>

        <!-- Agregar columna de Código SAT antes de Description -->
        <xpath expr="//th[@name='th_description']" position="before">
            <th name="th_product_code" class="text-start">Código del producto</th>
        </xpath>

        <xpath expr="//td[@name='account_invoice_line_name']" position="before">
            <td name="td_product_code">
                <span t-if="line.product_id" t-field="line.product_id.default_code"/>
            </td>
        </xpath>

        <!-- Cambiar título de th_description a "Descripción" -->
        <xpath expr="//th[@name='th_description']/span" position="replace">
            <span>Descripción</span>
        </xpath>

        <!-- Agregar columna de Lotes después de Description -->
        <xpath expr="//th[@name='th_description']" position="after">
            <th name="th_lots" class="text-start">Lotes</th>
        </xpath>

        <xpath expr="//td[@name='account_invoice_line_name']" position="after">
            <td name="td_lots">
                <span t-if="line.x_lotes" t-field="line.x_lotes"/>
            </td>
        </xpath>

        <!-- Agregar columna de Código de Unidad después de Quantity -->
        <xpath expr="//th[@name='th_quantity']" position="after">
            <th name="th_uom_code" class="text-start">Cód. Unidad</th>
        </xpath>

        <xpath expr="//td[@name='td_quantity']" position="after">
            <td name="td_uom_code">
                <span t-if="line.product_uom_id" t-field="line.product_uom_id.name"/>
            </td>
        </xpath>

        <!-- Agregar sección de pago al final -->
        <xpath expr="//div[@id='payment_term']" position="before">
            <div style="clear: both; margin-top: 20px; padding-top: 10px; border-top: 1px solid #ddd; font-size: 11px;">
                <div t-if="o.l10n_mx_edi_cfdi_uuid" style="margin-bottom: 10px;">
                    <strong>UUID:</strong> <span t-field="o.l10n_mx_edi_cfdi_uuid"/>
                </div>
                <strong>Referencia de pago:</strong> <span t-field="o.name"/><br/>
                <span t-if="o.amount_total_words">
                    <strong>Total en letra:</strong> <span t-field="o.amount_total_words"/> M.N
                </span>
            </div>
        </xpath>

    </template>
</odoo>
