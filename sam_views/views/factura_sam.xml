<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        Plantilla de factura personalizada para Samper
        Hereda de account.report_invoice_document para modificar el diseño de la factura
    -->

    <!-- Reporte de factura SAM -->
    <record id="report_invoice_sam" model="ir.actions.report">
        <field name="name">Factura SAM</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">sam_views.report_invoice_sam_main</field>
        <field name="report_file">sam_views.report_invoice_sam_main</field>
        <field name="print_report_name">'Factura - %s' % (object.name)</field>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Template principal del reporte -->
    <template id="report_invoice_sam_main">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="sam_views.report_invoice_document_sam" t-lang="lang"/>
            </t>
        </t>
    </template>

    <!-- Plantilla personalizada del documento de factura -->
    <template id="report_invoice_document_sam" inherit_id="account.report_invoice_document" primary="True">

        <!-- Reemplazar todo el contenido del documento -->
        <xpath expr="//t[@t-call='web.external_layout']" position="replace">
            <!-- No usar external_layout para tener control total del diseño -->
            <t t-set="o" t-value="o.with_context(lang=lang)"/>
            <t t-set="forced_vat" t-value="o.fiscal_position_id.foreign_vat"/>

            <div class="article" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')">
                <div class="page">
                    <!-- ============================================ -->
                    <!-- ENCABEZADO ULTRA COMPACTO -->
                    <!-- ============================================ -->
                    <!-- Obtener orden de venta relacionada para datos adicionales -->
                    <t t-set="sale_order" t-value="o.invoice_line_ids.mapped('sale_line_ids.order_id')[:1] if o.invoice_line_ids else False"/>
                    <t t-set="shipping_partner" t-value="sale_order.partner_shipping_id if sale_order else False"/>

                    <div class="row" style="margin-bottom: 2px;">
                        <!-- Columna izquierda: Logo + Info empresa -->
                        <div class="col-7" style="font-size: 7pt; line-height: 1.1;">
                            <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)"
                                 style="max-height: 50px; margin-bottom: 2px;" alt="Company Logo"/><br/>
                            <strong><span t-field="o.company_id.name"/></strong><br/>
                            <span t-field="o.company_id.street"/><br/>
                            <span t-field="o.company_id.zip"/> <span t-if="o.company_id.city" t-field="o.company_id.city"/>, <span t-if="o.company_id.state_id" t-field="o.company_id.state_id.code"/><br/>
                            <span t-if="o.company_id.country_id" t-field="o.company_id.country_id.name"/>
                        </div>

                        <!-- Columna derecha: Fecha/Hora -->
                        <div class="col-5 text-end" style="font-size: 7pt;">
                            <t t-if="o.create_date">
                                <span t-field="o.create_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm:ss'}"/>
                            </t>
                        </div>
                    </div>

                    <hr style="border-top: 1px solid #000; margin: 2px 0;"/>

                    <div class="row" style="margin-bottom: 2px;">
                        <!-- Columna izquierda: Dirección de entrega + Nombre comercial + Ruta -->
                        <div class="col-6" style="font-size: 7pt; line-height: 1.1;">
                            <div t-if="shipping_partner">
                                <strong>Dirección de entrega:</strong><br/>
                                <span t-field="shipping_partner.name"/><br/>
                                <span t-field="shipping_partner.street"/> <t t-if="shipping_partner.street2"><span t-field="shipping_partner.street2"/></t><br/>
                                <span t-field="shipping_partner.zip"/> <span t-if="shipping_partner.city" t-field="shipping_partner.city"/>, <span t-if="shipping_partner.state_id" t-field="shipping_partner.state_id.code"/>
                            </div>
                            <div t-if="o.partner_id.x_nombre_comercial" style="font-size: 11pt; margin-top: 2px; font-weight: bold;">
                                <span t-field="o.partner_id.x_nombre_comercial"/>
                            </div>
                            <div t-if="o.partner_id.x_ruta" style="font-size: 7pt;">
                                <span t-field="o.partner_id.x_ruta"/>
                            </div>
                        </div>

                        <!-- Columna derecha: Dirección de facturación -->
                        <div class="col-6" style="font-size: 7pt; line-height: 1.1;">
                            <strong><span t-field="o.partner_id.name"/></strong><br/>
                            <span t-field="o.partner_id.street"/> <t t-if="o.partner_id.street2"><span t-field="o.partner_id.street2"/></t><br/>
                            <span t-field="o.partner_id.zip"/> <span t-if="o.partner_id.city" t-field="o.partner_id.city"/>, <span t-if="o.partner_id.state_id" t-field="o.partner_id.state_id.code"/><br/>
                            <t t-if="o.partner_id.vat"><strong>RFC: </strong><span t-field="o.partner_id.vat"/></t>
                        </div>
                    </div>

                    <!-- ============================================ -->
                    <!-- TÍTULO DE LA FACTURA CON UUID -->
                    <!-- ============================================ -->
                    <div style="color: #8B2332; margin: 2px 0; font-size: 14pt; font-weight: bold;">
                        <t t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Factura </t>
                        <t t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">Borrador de Factura </t>
                        <t t-elif="o.move_type == 'out_invoice' and o.state == 'cancel'">Factura Cancelada </t>
                        <t t-elif="o.move_type == 'out_refund' and o.state == 'posted'">Nota de Crédito </t>
                        <t t-elif="o.move_type == 'out_refund' and o.state == 'draft'">Borrador de Nota de Crédito </t>
                        <t t-elif="o.move_type == 'out_refund' and o.state == 'cancel'">Nota de Crédito Cancelada </t>
                        <span t-if="o.name and o.name != '/'" t-field="o.name"/>
                    </div>

                    <!-- UUID/Folio Fiscal (si existe) -->
                    <div t-if="o.l10n_mx_edi_cfdi_uuid" style="font-size: 7pt; margin-bottom: 2px;">
                        <span t-field="o.l10n_mx_edi_cfdi_uuid"/>
                    </div>

                    <!-- ============================================ -->
                    <!-- INFORMACIÓN DE LA FACTURA (Formato Compacto) -->
                    <!-- ============================================ -->
                    <table style="width: 100%; font-size: 7pt; margin-bottom: 3px; border-collapse: collapse;">
                        <tr>
                            <td style="width: 14%; vertical-align: top; padding: 1px 3px 1px 0;">
                                <strong>Fecha:</strong> <span t-field="o.invoice_date"/>
                            </td>
                            <td style="width: 14%; vertical-align: top; padding: 1px 3px;">
                                <strong>Límite:</strong> <span t-if="o.invoice_date_due" t-field="o.invoice_date_due"/>
                            </td>
                            <td style="width: 12%; vertical-align: top; padding: 1px 3px;">
                                <strong>Origen:</strong> <span t-if="o.invoice_origin" t-field="o.invoice_origin"/>
                            </td>
                            <td style="width: 24%; vertical-align: top; padding: 1px 3px;">
                                <strong>Uso:</strong> <span t-if="o.l10n_mx_edi_usage" t-field="o.l10n_mx_edi_usage"/>
                            </td>
                            <td style="width: 18%; vertical-align: top; padding: 1px 3px;">
                                <strong>F. Pago:</strong>
                                <t t-if="o.l10n_mx_edi_payment_method_id">
                                    <span t-field="o.l10n_mx_edi_payment_method_id.code"/> - <span t-field="o.l10n_mx_edi_payment_method_id.name"/>
                                </t>
                            </td>
                            <td style="width: 10%; vertical-align: top; padding: 1px 3px;">
                                <strong>M. Pago:</strong> <span t-if="o.l10n_mx_edi_payment_policy" t-field="o.l10n_mx_edi_payment_policy"/>
                            </td>
                            <td t-if="o.ref" style="width: 18%; vertical-align: top; padding: 1px 3px;">
                                <strong>Ref:</strong> <span t-field="o.ref"/>
                            </td>
                        </tr>
                    </table>

                    <!-- ============================================ -->
                    <!-- TABLA DE PRODUCTOS -->
                    <!-- ============================================ -->
                    <t t-set="display_discount" t-value="any(l.discount for l in o.invoice_line_ids)"/>

                    <table class="table table-sm table-bordered" style="border: 2px solid #000; font-size: 8pt; margin-bottom: 5px;">
                        <thead style="background-color: #f5f5f5;">
                            <tr>
                                <th class="text-start" style="border: 1px solid #000; width: 8%;">Código<br/>Producto</th>
                                <th class="text-start" style="border: 1px solid #000; width: 22%;">Descripción</th>
                                <th class="text-start" style="border: 1px solid #000; width: 15%;">Lotes</th>
                                <th class="text-end" style="border: 1px solid #000; width: 8%;">Cantidad</th>
                                <th class="text-end" style="border: 1px solid #000; width: 5%;">Pzas</th>
                                <th class="text-end" style="border: 1px solid #000; width: 9%;">Precio<br/>unitario</th>
                                <th class="text-center" style="border: 1px solid #000; width: 6%;">Código<br/>Unidad</th>
                                <th class="text-center" style="border: 1px solid #000; width: 12%;">Impuestos</th>
                                <th class="text-end" style="border: 1px solid #000; width: 10%;">Importe</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>

                            <t t-foreach="lines" t-as="line">
                                <t t-if="line.display_type == 'product'">
                                    <tr>
                                        <!-- Código de producto -->
                                        <td style="border: 1px solid #000; vertical-align: top; font-size: 8pt;">
                                            <span t-if="line.product_id.default_code" t-field="line.product_id.default_code"/>
                                        </td>

                                        <!-- Descripción -->
                                        <td style="border: 1px solid #000; vertical-align: top;">
                                            <span t-if="line.name" t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>

                                        <!-- Lotes (en la misma tabla) -->
                                        <td style="border: 1px solid #000; vertical-align: top; font-size: 8pt;">
                                            <!-- Acceder a lotes a través de sale_line_ids -> move_ids -> move_line_ids -->
                                            <t t-if="line.sale_line_ids">
                                                <t t-foreach="line.sale_line_ids" t-as="sale_line">
                                                    <t t-if="sale_line.move_ids">
                                                        <t t-foreach="sale_line.move_ids" t-as="stock_move">
                                                            <t t-if="stock_move.move_line_ids">
                                                                <t t-foreach="stock_move.move_line_ids.filtered(lambda ml: ml.lot_id)" t-as="move_line">
                                                                    <div>
                                                                        <span t-field="move_line.quantity" t-options="{'widget': 'float', 'precision': 1}"/>
                                                                        <span t-field="move_line.lot_id.name"/><br/>
                                                                        <t t-if="move_line.lot_id.expiration_date">
                                                                            <span t-field="move_line.lot_id.expiration_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/yyyy HH:mm:ss'}"/> |
                                                                        </t>
                                                                    </div>
                                                                </t>
                                                            </t>
                                                        </t>
                                                    </t>
                                                </t>
                                            </t>
                                        </td>

                                        <!-- Cantidad -->
                                        <td class="text-end" style="border: 1px solid #000; vertical-align: top;">
                                            <span t-field="line.quantity" t-options="{'widget': 'float', 'precision': 3}"/>
                                            <span t-field="line.product_uom_id.name"/>
                                        </td>

                                        <!-- Pzas (piezas - si aplica) -->
                                        <td class="text-end" style="border: 1px solid #000; vertical-align: top;">
                                            <!-- Espacio para piezas si aplica -->
                                        </td>

                                        <!-- Precio unitario -->
                                        <td class="text-end" style="border: 1px solid #000; vertical-align: top;">
                                            <span t-field="line.price_unit" t-options="{'widget': 'float', 'precision': 2}"/>
                                        </td>

                                        <!-- Código Unidad (SAT) -->
                                        <td class="text-center" style="border: 1px solid #000; vertical-align: top; font-size: 8pt;">
                                            <span t-if="line.product_uom_id.unspsc_code_id" t-field="line.product_uom_id.unspsc_code_id.code"/>
                                        </td>

                                        <!-- Impuestos -->
                                        <td class="text-center" style="border: 1px solid #000; vertical-align: top;">
                                            <t t-set="taxes" t-value="', '.join([(tax.invoice_label or tax.name) for tax in line.tax_ids])"/>
                                            <span t-out="taxes"/>
                                        </td>

                                        <!-- Importe -->
                                        <td class="text-end" style="border: 1px solid #000; vertical-align: top;">
                                            <span t-field="line.price_subtotal" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                        </td>
                                    </tr>
                                </t>

                                <!-- Secciones y notas -->
                                <t t-elif="line.display_type == 'line_section'">
                                    <tr style="background-color: #f5f5f5;">
                                        <td colspan="9" style="border: 1px solid #000;">
                                            <strong><span t-field="line.name"/></strong>
                                        </td>
                                    </tr>
                                </t>
                                <t t-elif="line.display_type == 'line_note'">
                                    <tr>
                                        <td colspan="9" style="border: 1px solid #000;">
                                            <em><span t-field="line.name"/></em>
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                    </table>

                    <!-- ============================================ -->
                    <!-- TOTALES -->
                    <!-- ============================================ -->
                    <div style="width: 100%; margin-top: 5px;">
                        <table style="width: 40%; margin-left: auto; font-size: 8pt; border-collapse: collapse;">
                            <!-- Importe sin impuestos -->
                            <tr>
                                <td style="text-align: right; padding: 2px 8px; color: #8B2332;">
                                    <strong>Importe sin impuestos</strong>
                                </td>
                                <td style="text-align: right; padding: 2px 8px;">
                                    <span t-field="o.amount_untaxed" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                </td>
                            </tr>

                            <!-- Impuestos (cada línea de impuesto) -->
                            <t t-set="has_tax_details" t-value="False"/>
                            <t t-if="o.tax_totals and o.tax_totals.get('groups_by_subtotal')">
                                <t t-foreach="o.tax_totals['groups_by_subtotal'].values()" t-as="amount_by_group">
                                    <t t-foreach="amount_by_group" t-as="group">
                                        <t t-set="has_tax_details" t-value="True"/>
                                        <tr>
                                            <td style="text-align: right; padding: 2px 8px;">
                                                <span t-out="group.get('tax_group_name', 'IVA')"/>
                                                <span t-out="' %.0f%%' % group.get('tax_group_base_amount_percent', 0)"/>
                                            </td>
                                            <td style="text-align: right; padding: 2px 8px;">
                                                <span t-out="group.get('formatted_tax_group_amount', '0.00')"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                            </t>

                            <!-- Fallback: Si no hay detalles de impuestos, mostrar línea aunque sea 0 -->
                            <tr t-if="not has_tax_details">
                                <td style="text-align: right; padding: 2px 8px;">
                                    IVA 0%
                                </td>
                                <td style="text-align: right; padding: 2px 8px;">
                                    <span t-field="o.amount_tax" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                </td>
                            </tr>

                            <!-- Total -->
                            <tr style="border-top: 2px solid #000;">
                                <td style="text-align: right; padding: 4px 8px;">
                                    <strong style="color: #8B2332; font-size: 9pt;">Total</strong>
                                </td>
                                <td style="text-align: right; padding: 4px 8px;">
                                    <strong style="color: #8B2332; font-size: 9pt;">
                                        <span t-field="o.amount_total" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </strong>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Referencia de pago -->
                    <div style="font-size: 8pt; margin-top: 5px;">
                        <t t-if="o.payment_reference or o.name">
                            Utilice la siguiente referencia al realizar su pago: <strong><span t-esc="o.payment_reference or o.name"/></strong>
                        </t>
                    </div>

                    <!-- Importe con letra -->
                    <div style="font-size: 8pt; margin-top: 3px;">
                        <t t-if="o.company_id.display_invoice_amount_total_words and o.amount_total_words">
                            <span t-field="o.amount_total_words" style="text-transform: uppercase;"/>
                        </t>
                    </div>

                    <!-- Comentarios -->
                    <div style="margin-top: 5px; font-size: 7pt;" t-if="o.narration">
                        <span t-field="o.narration"/>
                    </div>

                    <!-- ============================================ -->
                    <!-- QR Y SELLOS EN PÁGINA 1 (SOLO SI HAY POCOS PRODUCTOS) -->
                    <!-- ============================================ -->
                    <t t-set="num_products" t-value="len(o.invoice_line_ids.filtered(lambda l: l.display_type == 'product'))"/>
                    <t t-if="o.l10n_mx_edi_cfdi_uuid and o.state == 'posted' and num_products &lt;= 3">
                        <div style="margin-top: 10px; font-size: 7pt;">
                            <div class="row">
                                <!-- QR Code -->
                                <div class="col-3">
                                    <strong>QR CFDI:</strong><br/>
                                    <t t-set="qr_data" t-value="'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?id=' + str(o.l10n_mx_edi_cfdi_uuid)"/>
                                    <img t-att-src="'/report/barcode/?type=QR&amp;value=' + qr_data + '&amp;width=120&amp;height=120'"
                                         style="width: 120px; height: 120px;"
                                         alt="QR CFDI"/>
                                </div>

                                <!-- Información de Certificados -->
                                <div class="col-9" style="font-size: 6pt; line-height: 1.2;">
                                    <strong>Información de Certificados:</strong><br/>
                                    <strong>Cert. Emisor:</strong> <span t-field="o.x_cfdi_certificado_emisor"/> |
                                    <strong>Cert. SAT:</strong> <span t-field="o.x_cfdi_certificado_sat"/> |
                                    <strong>Folio Fiscal:</strong> <span t-field="o.l10n_mx_edi_cfdi_uuid"/><br/>
                                    <strong>Sello Emisor:</strong> <span t-if="o.x_cfdi_sello_emisor" t-esc="o.x_cfdi_sello_emisor[:100] + '...'"/><br/>
                                    <strong>Sello SAT:</strong> <span t-if="o.x_cfdi_sello_sat" t-esc="o.x_cfdi_sello_sat[:100] + '...'"/>
                                </div>
                            </div>
                        </div>
                    </t>

                    <!-- Footer de la primera página -->
                    <div style="width: 100%; text-align: center; font-size: 7pt; border-top: 1px solid #ccc; padding-top: 3px; margin-top: 8px;">
                        <span t-if="o.company_id.email"><span t-field="o.company_id.email"/> | </span>
                        <span t-if="o.company_id.website"><span t-field="o.company_id.website"/> | </span>
                        <span t-if="o.company_id.vat">RFC: <span t-field="o.company_id.vat"/></span>
                    </div>

                </div>

                <!-- ============================================ -->
                <!-- SEGUNDA PÁGINA: INFORMACIÓN FISCAL CFDI (SOLO SI HAY MUCHOS PRODUCTOS) -->
                <!-- ============================================ -->
                <t t-set="num_products" t-value="len(o.invoice_line_ids.filtered(lambda l: l.display_type == 'product'))"/>
                <t t-if="o.l10n_mx_edi_cfdi_uuid and o.state == 'posted' and num_products &gt; 3">
                    <div class="page" style="page-break-before: always; font-size: 7pt;">
                        <!-- Encabezado compacto página 2 -->
                        <div style="margin-bottom: 5px;">
                            <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)"
                                 style="max-height: 50px;" alt="Company Logo"/>
                        </div>

                        <hr style="border-top: 1px solid #000; margin-bottom: 5px;"/>

                        <!-- Información de la empresa -->
                        <div style="text-align: center; margin-bottom: 10px; font-size: 7pt;">
                            <strong><span t-field="o.company_id.name"/></strong><br/>
                            <span t-field="o.company_id.street"/>,
                            <span t-field="o.company_id.zip"/>
                            <span t-field="o.company_id.city"/>,
                            <span t-field="o.company_id.state_id.code"/>,
                            <span t-field="o.company_id.country_id.name"/>
                        </div>

                        <!-- Layout de dos columnas: QR a la izquierda, información a la derecha -->
                        <div style="display: table; width: 100%; margin-bottom: 10px;">
                            <!-- Código QR en la izquierda -->
                            <div style="display: table-cell; width: 25%; vertical-align: top; padding-right: 10px;">
                                <!-- Generar código QR dinámicamente del CFDI -->
                                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                    <t t-set="qr_data" t-value="'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?id=' + str(o.l10n_mx_edi_cfdi_uuid)"/>

                                    <div style="text-align: center;">
                                        <img t-att-src="'/report/barcode/?type=QR&amp;value=' + qr_data + '&amp;width=150&amp;height=150'"
                                             style="width: 150px; height: 150px; border: 1px solid #ccc;"
                                             alt="QR Code CFDI"/>
                                    </div>
                                </t>
                                <div t-else="" style="width: 150px; height: 150px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center; font-size: 7pt; color: #999; text-align: center;">
                                    QR no disponible<br/>(Factura sin timbrar)
                                </div>
                            </div>

                            <!-- Información de certificados en la derecha -->
                            <div style="display: table-cell; width: 70%; vertical-align: top;">
                                <div style="margin-bottom: 15px;">
                                    <strong style="font-size: 9pt;">Información de Certificados</strong><br/>
                                    <table style="width: 100%; font-size: 8pt; margin-top: 5px;">
                                        <tr>
                                            <td style="padding: 3px;"><strong>Certificado del emisor:</strong></td>
                                            <td style="padding: 3px;"><span t-field="o.x_cfdi_certificado_emisor"/></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 3px;"><strong>Certificado SAT:</strong></td>
                                            <td style="padding: 3px;"><span t-field="o.x_cfdi_certificado_sat"/></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 3px;"><strong>Lugar de expedición:</strong></td>
                                            <td style="padding: 3px;"><span t-field="o.company_id.zip"/></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 3px;"><strong>Folio Fiscal:</strong></td>
                                            <td style="padding: 3px;"><span t-field="o.l10n_mx_edi_cfdi_uuid"/></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 3px;"><strong>Fecha de Emisión:</strong></td>
                                            <td style="padding: 3px;"><span t-field="o.invoice_date"/></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 3px;"><strong>Fecha de Certificación:</strong></td>
                                            <td style="padding: 3px;"><span t-field="o.x_cfdi_fecha_certificacion"/></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Sellos digitales extraídos del XML del CFDI -->
                        <div style="margin-bottom: 10px;">
                            <strong style="font-size: 9pt;">Sello digital del emisor</strong>
                            <div style="font-size: 7pt; word-wrap: break-word; word-break: break-all; font-family: 'Courier New', monospace; margin: 5px 0; line-height: 1.4; padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; overflow-wrap: break-word;">
                                <span t-if="o.x_cfdi_sello_emisor" t-esc="o.x_cfdi_sello_emisor"/>
                                <span t-else="" style="color: #999;">No disponible</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 10px;">
                            <strong style="font-size: 9pt;">Sello digital del SAT</strong>
                            <div style="font-size: 7pt; word-wrap: break-word; word-break: break-all; font-family: 'Courier New', monospace; margin: 5px 0; line-height: 1.4; padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; overflow-wrap: break-word;">
                                <span t-if="o.x_cfdi_sello_sat" t-esc="o.x_cfdi_sello_sat"/>
                                <span t-else="" style="color: #999;">No disponible</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 10px;">
                            <strong style="font-size: 9pt;">Cadena original del complemento del certificado digital del SAT</strong>
                            <div style="font-size: 7pt; word-wrap: break-word; word-break: break-all; font-family: 'Courier New', monospace; margin: 5px 0; line-height: 1.4; padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; overflow-wrap: break-word;">
                                <span t-if="o.l10n_mx_edi_cfdi_uuid and o.x_cfdi_fecha_certificacion and o.x_cfdi_certificado_sat">
                                    ||1.1|<span t-esc="o.l10n_mx_edi_cfdi_uuid"/>|<span t-esc="o.x_cfdi_fecha_certificacion"/>|<span t-esc="o.x_cfdi_certificado_sat"/>||
                                </span>
                                <span t-else="" style="color: #999;">No disponible</span>
                            </div>
                        </div>

                        <!-- Información Extra (al final, antes de la leyenda) -->
                        <div style="margin-bottom: 10px;">
                            <strong style="font-size: 9pt;">Información Extra</strong>
                            <div style="font-size: 7pt; word-wrap: break-word; font-family: 'Courier New', monospace; margin: 5px 0; line-height: 1.4; padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd;">
                                <strong>Certificado del emisor:</strong> <span t-field="o.x_cfdi_certificado_emisor"/> |
                                <strong>Certificado SAT:</strong> <span t-field="o.x_cfdi_certificado_sat"/><br/>
                                <strong>Lugar de expedición:</strong> <span t-field="o.company_id.zip"/> |
                                <strong>Folio Fiscal:</strong> <span t-field="o.l10n_mx_edi_cfdi_uuid"/><br/>
                                <strong>Fecha de Emisión:</strong> <span t-field="o.invoice_date"/> |
                                <strong>Fecha de Certificación:</strong> <span t-field="o.x_cfdi_fecha_certificacion"/>
                            </div>
                        </div>

                        <!-- Leyenda CFDI -->
                        <div style="text-align: center; margin-top: 20px; margin-bottom: 15px;">
                            <strong style="font-size: 9pt;">Este documento es una representación impresa de un CFDI</strong>
                        </div>

                        <!-- Footer de página 2 con información de contacto -->
                        <div style="width: 100%; text-align: center; font-size: 8pt; border-top: 1px solid #ccc; padding-top: 5px; margin-top: 10px;">
                            <span t-if="o.company_id.email"><span t-field="o.company_id.email"/> | </span>
                            <span t-if="o.company_id.website"><span t-field="o.company_id.website"/> | </span>
                            <span t-if="o.company_id.vat">RFC: <span t-field="o.company_id.vat"/></span>
                            <div style="text-align: right; margin-top: 3px;">
                                Página 2 / 2
                            </div>
                        </div>
                    </div>
                </t>

            </div>
        </xpath>

    </template>
</odoo>
