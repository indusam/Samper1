<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="w_extend_cfdiv33_addenda_liverpool" inherit_id="l10n_mx_edi.cfdiv33" name="Addenda Liverpool">
            <xpath expr="*" position="inside">
                <t t-if="record.use_addenda">
                    <cfdi:Complemento xmlns:cfdi="http://www.sat.gob.mx/cfd/3">
                        <detallista:detallista contentVersion="1.3.1" documentStructureVersion="AMC8.1" type="SimpleInvoiceType" documentStatus="ORIGINAL">
                            <detallista:requestForPaymentIdentification>
                                <t t-if="record.type in ('out_invoice', 'in_invoice')">
                                    <detallista:entityType>INVOICE</detallista:entityType>
                                </t>
                                <t t-if="record.type in ('out_refund', 'in_refund')">
                                    <detallista:entityType>CREDIT_NOTE</detallista:entityType>
                                </t>
                            </detallista:requestForPaymentIdentification>
                            <detallista:specialInstruction code="ZZZ">
                                <detallista:text><t if="record.l10n_mx_edi_amount_to_text()" t-esc="record.unescape_characters(record.l10n_mx_edi_amount_to_text())"/></detallista:text>
                            </detallista:specialInstruction>
                            <detallista:orderIdentification>
                                <detallista:referenceIdentification type="ON"><t t-if="record.purchase_order_liv" t-esc="record.unescape_characters(record.purchase_order_liv)"/></detallista:referenceIdentification>
                            </detallista:orderIdentification>
                            <detallista:AdditionalInformation>
                                <detallista:referenceIdentification type="IV"><t t-if="record.name" t-esc="record.unescape_characters(record.name)"/></detallista:referenceIdentification>
                            </detallista:AdditionalInformation>
                            <detallista:DeliveryNote>
                                <detallista:referenceIdentification><t t-if="record.delivery_folio" t-esc="record.unescape_characters(record.delivery_folio)"/></detallista:referenceIdentification>
                                <detallista:ReferenceDate><t t-esc="record.date_delivery"/></detallista:ReferenceDate>
                            </detallista:DeliveryNote>
                            <detallista:buyer>
                                <detallista:gln><t t-if="record.partner_id.global_localitation_number" t-esc="record.unescape_characters(record.partner_id.global_localitation_number)"/></detallista:gln>
                                <detallista:contactInformation>
                                    <detallista:personOrDepartmentName>
                                        <detallista:text><t t-if="record.partner_id.person_order_department" t-esc="record.unescape_characters(record.partner_id.person_order_department)"/></detallista:text>
                                    </detallista:personOrDepartmentName>
                                </detallista:contactInformation>
                            </detallista:buyer>
                            <detallista:seller>
                                <detallista:gln><t t-if="record.company_id.global_localitation_number" t-esc="record.unescape_characters(record.company_id.global_localitation_number)"/></detallista:gln>
                                <detallista:alternatePartyIdentification type="SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY"><t t-if="record.partner_id.supplier_identification" t-esc="record.unescape_characters(record.partner_id.supplier_identification)"/></detallista:alternatePartyIdentification>
                            </detallista:seller>
                            <t t-set="line_counts" t-value="0"/>
                            <t t-foreach="record.invoice_line_ids.filtered(lambda inv: not inv.display_type)" t-as="line">
                                <t t-set="line_counts" t-value="line_counts + 1"/>
                                <detallista:lineItem t-att-number="line_counts" type="SimpleInvoiceLineItemType">
                                    <detallista:tradeItemIdentification>
                                        <detallista:gtin><t t-esc="line.product_id.barcode"/></detallista:gtin>
                                    </detallista:tradeItemIdentification>
                                    <detallista:alternateTradeItemIdentification type="SUPPLIER_ASSIGNED"><t t-if="line.product_id.default_code" t-esc="record.unescape_characters(line.product_id.default_code)"/></detallista:alternateTradeItemIdentification>
                                        <detallista:tradeItemDescriptionInformation language="ES">
                                            <detallista:longText><t t-if="line.product_id.name" t-esc="record.unescape_characters(line.product_id.name)"/></detallista:longText>
                                        </detallista:tradeItemDescriptionInformation>
                                        <detallista:invoicedQuantity t-att-unitOfMeasure="line.product_id.x_uom_addenda"><t t-esc="line.quantity"/></detallista:invoicedQuantity>
                                        <!-- <detallista:invoicedQuantity t-att-unitOfMeasure="line.product_uom_id.name"><t t-esc="line.quantity"/></detallista:invoicedQuantity> -->
                                        <detallista:grossPrice>
                                            <detallista:Amount><t t-esc="line.get_price_gross()"/></detallista:Amount>
                                        </detallista:grossPrice>
                                        <detallista:netPrice>
                                            <detallista:Amount><t t-esc="line.get_price_net()"/></detallista:Amount>
                                        </detallista:netPrice>
                                        <detallista:totalLineAmount>
                                            <detallista:grossAmount>
                                                <detallista:Amount><t t-esc="line.get_gross_amount()"/></detallista:Amount>
                                            </detallista:grossAmount>
                                            <detallista:netAmount>
                                                <detallista:Amount><t t-esc="line.get_net_amount()"/></detallista:Amount>
                                            </detallista:netAmount>
                                        </detallista:totalLineAmount>
                                </detallista:lineItem>
                            </t>
                            <detallista:totalAmount>
                                <detallista:Amount><t t-esc="record.get_total_amount()"/></detallista:Amount>
                            </detallista:totalAmount>
                            <detallista:TotalAllowanceCharge allowanceOrChargeType="ALLOWANCE">
                                <detallista:Amount>0.00</detallista:Amount>
                            </detallista:TotalAllowanceCharge>
                        </detallista:detallista>
                    </cfdi:Complemento>
                </t>
            </xpath>
        </template>

        <record id="w_extend_cfdiv33_addenda_liverpool" model="ir.ui.view">
            <field name="l10n_mx_edi_addenda_flag">True</field>
        </record>
    </data>
</odoo>