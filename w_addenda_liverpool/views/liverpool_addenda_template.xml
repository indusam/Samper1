<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="liverpool_addenda_appendix" name="Liverpool Addenda Appendix">
        <detallista:detallista xmlns:detallista="http://www.sat.gob.mx/detallista"
                               contentVersion="1.3.1"
                               documentStructureVersion="AMC8.1"
                               type="SimpleInvoiceType"
                               documentStatus="ORIGINAL">
            <detallista:requestForPaymentIdentification>
                <t t-if="record.move_type in ('out_invoice', 'in_invoice')">
                    <detallista:entityType>INVOICE</detallista:entityType>
                </t>
                <t t-elif="record.move_type in ('out_refund', 'in_refund')">
                    <detallista:entityType>CREDIT_NOTE</detallista:entityType>
                </t>
            </detallista:requestForPaymentIdentification>
            <detallista:specialInstruction code="ZZZ">
                <detallista:text><t t-out="record.unescape_characters(record._l10n_mx_edi_cfdi_amount_to_text())"/></detallista:text>
            </detallista:specialInstruction>
            <detallista:orderIdentification>
                <detallista:referenceIdentification type="ON"><t t-out="record.purchase_order_liv or 'N/A'"/></detallista:referenceIdentification>
            </detallista:orderIdentification>
            <detallista:AdditionalInformation>
                <detallista:referenceIdentification type="IV"><t t-out="record.unescape_characters(record.name)"/></detallista:referenceIdentification>
            </detallista:AdditionalInformation>
            <detallista:DeliveryNote>
                <detallista:referenceIdentification><t t-out="record.delivery_folio or 'N/A'"/></detallista:referenceIdentification>
                <detallista:ReferenceDate><t t-out="record.date_delivery or record.invoice_date"/></detallista:ReferenceDate>
            </detallista:DeliveryNote>
            <detallista:buyer>
                <detallista:gln><t t-out="record.partner_id.global_localitation_number or '0000000000000'"/></detallista:gln>
                <t t-if="record.partner_id.person_order_department">
                    <detallista:contactInformation>
                        <detallista:personOrDepartmentName>
                            <detallista:text><t t-out="record.unescape_characters(record.partner_id.person_order_department)"/></detallista:text>
                        </detallista:personOrDepartmentName>
                    </detallista:contactInformation>
                </t>
            </detallista:buyer>
            <detallista:seller>
                <detallista:gln><t t-out="record.company_id.global_localitation_number or '0000000000000'"/></detallista:gln>
                <detallista:alternatePartyIdentification type="SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY"><t t-out="record.partner_id.supplier_identification or record.company_id.vat or 'N/A'"/></detallista:alternatePartyIdentification>
            </detallista:seller>
            <t t-set="line_counts" t-value="0"/>
            <t t-foreach="record.invoice_line_ids.filtered(lambda l: l.product_id and not l.display_type)" t-as="line">
                <t t-set="line_counts" t-value="line_counts + 1"/>
                <detallista:lineItem t-att-number="line_counts" type="SimpleInvoiceLineItemType">
                    <detallista:tradeItemIdentification>
                        <detallista:gtin><t t-out="line.product_id.barcode or '00000000000000'"/></detallista:gtin>
                    </detallista:tradeItemIdentification>
                    <detallista:alternateTradeItemIdentification type="SUPPLIER_ASSIGNED"><t t-out="line.product_id.default_code or str(line.product_id.id)"/></detallista:alternateTradeItemIdentification>
                    <detallista:tradeItemDescriptionInformation language="ES">
                        <detallista:longText><t t-out="record.unescape_characters((line.product_id.name or line.name or 'PRODUCTO')[:35])"/></detallista:longText>
                    </detallista:tradeItemDescriptionInformation>
                    <detallista:invoicedQuantity t-att-unitOfMeasure="line.product_uom_id.name"><t t-out="line.get_quantity()"/></detallista:invoicedQuantity>
                    <detallista:grossPrice>
                        <detallista:Amount><t t-out="line.get_price_gross()"/></detallista:Amount>
                    </detallista:grossPrice>
                    <detallista:netPrice>
                        <detallista:Amount><t t-out="line.get_price_net()"/></detallista:Amount>
                    </detallista:netPrice>
                    <detallista:totalLineAmount>
                        <detallista:grossAmount>
                            <detallista:Amount><t t-out="line.get_gross_amount()"/></detallista:Amount>
                        </detallista:grossAmount>
                        <detallista:netAmount>
                            <detallista:Amount><t t-out="line.get_net_amount()"/></detallista:Amount>
                        </detallista:netAmount>
                    </detallista:totalLineAmount>
                </detallista:lineItem>
            </t>
            <detallista:totalAmount>
                <detallista:Amount><t t-out="record.get_total_amount()"/></detallista:Amount>
            </detallista:totalAmount>
            <detallista:TotalAllowanceCharge allowanceOrChargeType="ALLOWANCE">
                <detallista:Amount>0.00</detallista:Amount>
            </detallista:TotalAllowanceCharge>
        </detallista:detallista>
    </template>
</odoo>
